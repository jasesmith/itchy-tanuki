!function(e,r){"use strict";angular.module("app",["jamfu","ui.sortable"]).controller("AppController",["$scope","$location","StorageService","UtilityService",function(o,t,n,s){r.mixin({clamp2:function(e,r,o){return Math.min(Math.max(e,r),o)}});var a={useHash:!1,allowBW:!1,showHistory:!1,alwaysShowHex:!1,tanukiMode:!1,hexMode:3,tweeks:{klumpf:2,ichtzy:5,flarp:100,plark:1,marklar:.01,quarble:.08,cappa:!0}};o.colorHistory=n.get("tanuki-history")||[],o.myColors=n.get("tanuki-colors")||[],o.preferences=n.get("tanuki-preferences")||a,o.showMenu=!1,o.showSliders=!1,o.colorSteps=5,o.sortableOptions={placeholder:"color-brick parking-spot",tolerance:"pointer",stop:function(){var e=r.clone(o.myColors),t=r.map(e,function(e){return e});o.$apply(),o.myColors=r.compact(t),n.save("tanuki-colors",o.myColors)}};var i=function f(){return!o.$root.$$phase},l=function(e,t){var s=r.find(e,function(e){return e===t});s!==t&&e.push(t),o.colorHistory=r.last(e,25),n.save("tanuki-history",o.colorHistory)},c=function(e,r){var o=e.b|e.g<<8|e.r<<16|1<<24;return(r?"#":"")+o.toString(16).substring(1,8)};o.clearColorHistory=function(){o.colorHistory=[],n.save("tanuki-history",o.colorHistory)},o.clearSavedColors=function(){o.myColors=[],n.save("tanuki-colors",o.myColors)},o.resetTweeks=function(){o.preferences.tweeks=e.copy(a.tweeks)};var u=function(e){(r.isUndefined(e)||"#"===e)&&(e=s.randomHexColor()),e=e.toHexColor().toLowerCase(),l(o.colorHistory,e);var t=s.colorBrightness(e),n=[];r.times(50,function(r){if(r%o.colorSteps===0){var a=e.darken(r);("#000000"!==a||o.preferences.allowBW)&&(t<o.colorSteps?n.push(a):t-s.colorBrightness(a)>o.colorSteps&&n.push(a))}});var a=[];r.times(50,function(r){if(r%o.colorSteps===0){var t=50-r,n=e.lighten(t);("#ffffff"!==n||o.preferences.allowBW)&&a.push(n)}}),o.darker=r.unique(n),o.lighter=r.unique(a),o.lightest=r.first(o.lighter),o.darkest=r.last(o.darker),o.alternates=r.unique(o.lighter.concat([e]).concat(o.darker)),o.preferences.tanukiMode||o.alternates.push(o.darkest),o.deg=360/(o.alternates.length-1),o.size=Math.floor((100/(o.alternates.length-2)+Math.PI)/2),o.color=e,o.tuner={r:e.red(),g:e.green(),b:e.blue(),hex:e,brightness:t},o.brightness=t,o.controlBg=r.first(o.darker),o.controlFg=r.last(o.lighter),o.accent=o.alternates[o.alternates.length-4];var c=r.findIndex(o.alternates,function(e){return e===o.color});if(o.ringDeg=o.deg*(c+1),o.preferences.useHash&&(window.location.hash=e.replace("#","#/")),i())try{o.$apply()}catch(u){}};o.doIt=function(e){u(e)},o.setNewColor=function(e){o.tuner.hex=c(e,!0),o.tuner.brightness=s.colorBrightness(o.tuner.hex),u(o.tuner.hex)},o.setRingRotation=function(){var e=o.alternates.length*(o.preferences.tanukiMode?o.preferences.tweeks.quarble:a.tweeks.quarble);return{transform:"rotate(-"+o.ringDeg+"deg) translateZ(0)",transitionDuration:e+"s"}},o.setRotation=function(e){var r=e+1,t=o.deg*r,n="0 -"+o.size+"em",s=o.preferences.tanukiMode?r:o.alternates.length-r,i=o.preferences.tanukiMode?r*o.preferences.tweeks.quarble:r*a.tweeks.quarble,l="",c="",u="",f;return o.preferences.tanukiMode&&(f=o.preferences.tweeks.cappa?-(Math.E*(Math.ceil(r/o.preferences.tweeks.klumpf)*o.preferences.tweeks.marklar)-Math.ceil(r/o.preferences.tweeks.klumpf)):-(Math.E*(r/o.preferences.tweeks.klumpf*o.preferences.tweeks.marklar-r/o.preferences.tweeks.klumpf)),c=" scale("+f*o.preferences.tweeks.plark+")",u="-"+f+"vmax",n=""),o.preferences.tanukiMode||r!==o.alternates.length||(t=360,n="0 -"+o.size+"em 0 0",s=o.alternates.length),l="rotate("+t+"deg)",{transform:l+c,fontSize:u,margin:n,transitionDelay:i+"s",zIndex:s}},o.setRotationClasses=function(e){var r=Math.abs(o.ringDeg-o.deg*(e+1));return r>90&&270>r?"flip-my-hex":""},o.saveColor=function(e){var t=r.findIndex(o.myColors,function(r){return r===e});t>-1?o.myColors.splice(t,1):o.myColors.push(e),n.save("tanuki-colors",o.myColors)},o.shareColors=function(){var e="";r.each(o.myColors,function(r){e+="\n"+r+"\n"}),window.location.href="mailto:?subject=Colors&body="+encodeURIComponent(e)},o.isSaved=function(e){return r.find(o.myColors,function(r){return r===e})},o.loadColor=function(e){o.preferences.useHash?window.location.hash=e.toLowerCase().replace("#","#/"):u(e)},o.setClasses=function(e,r,o){if(e){var t=[];if(o){var n=s.colorBrightness(e)<155?"fg-light":"fg-dark";t.push(n)}return e===r&&t.push("current"),t.join(" ")}},o.$watch(function(){var e=window.location.hash;return e?e.replace("/",""):""},function(e){u(e)}),o.$watch("tuner",function(e,r){return e&&e!==r?(e.hex=c(e,!0),e.brightness=s.colorBrightness(e.hex),e.hex):void 0},!0),o.$watch("colorSteps",function(e,r){e&&e!==r&&u(o.color)}),o.$watch("preferences",r.debounce(function(e,r){o.$apply(function(){window.console.log(e),n.save("tanuki-preferences",e),(e&&e.tanukiMode!==r.tanukiMode||e.allowBW!==r.allowBW)&&u(o.color)})},500),!0),$(window.document).on("keyup",function(e){window.console.log(e.keyCode),32===e.keyCode&&u(),27===e.keyCode&&(o.showMenu=!1,o.showSliders=!1,o.favs=!1,o.$apply())})}])}(window.angular,window._);