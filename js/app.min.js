!function(e,r){"use strict";angular.module("app",["jamfu","ui.sortable"]).controller("AppController",["$scope","$location","StorageService","UtilityService",function(e,o,n,t){e.headline="Itchy Tanuki",e.icon="circle-o",e.colorHistory=n.get("tanuki-history")||[],e.myColors=n.get("tanuki-colors")||[],e.preferences=n.get("tanuki-preferences")||{useHash:!1,showHistory:!1,alwaysShowHex:!1},e.useHash=e.preferences.useHash,e.showHistory=e.preferences.showHistory,e.showMenu=!1,e.sortableOptions={placeholder:"color-brick parking-spot",tolerance:"pointer",stop:function(){var o=r.clone(e.myColors),t=r.map(o,function(e){return e});e.$apply(),e.myColors=r.compact(t),n.save("tanuki-colors",e.myColors)}};var s=function l(){return!e.$root.$$phase},a=function(o,t){var s=r.find(o,function(e){return e===t});s!==t&&o.push(t),e.colorHistory=r.last(o,25),n.save("tanuki-history",e.colorHistory)};e.clearColorHistory=function(){e.colorHistory=[],n.save("tanuki-history",e.colorHistory)},e.clearSavedColors=function(){e.myColors=[],n.save("tanuki-colors",e.myColors)};var i=function(o){if(o=o?o.toLowerCase():t.randomHexColor().toLowerCase(),a(e.colorHistory,o),e.darker=r.unique([o.darken(5),o.darken(10),o.darken(15),o.darken(20),o.darken(25),o.darken(30),o.darken(35),o.darken(40),o.darken(45),o.darken(50)]),e.lighter=r.unique([o.lighten(50),o.lighten(45),o.lighten(40),o.lighten(35),o.lighten(30),o.lighten(25),o.lighten(20),o.lighten(15),o.lighten(10),o.lighten(5)]),e.lightest=r.first(e.lighter),e.darkest=r.last(e.darker),e.lighter.push(o),e.alternates=r.unique(e.lighter.concat(e.darker)),e.alternates.push(e.darkest),e.deg=360/(e.alternates.length-1),e.size=Math.floor((100/(e.alternates.length-1)+Math.PI)/2),e.color=o,e.brightness=t.colorBrightness(o),e.controlBg=r.first(e.darker),e.controlFg=r.last(e.lighter),e.preferences.useHash&&(window.location.hash=o.replace("#","#/")),s())try{e.$apply()}catch(n){}};e.setRingRotation=function(){var o=r.findIndex(e.alternates,function(r){return r===e.color}),n=e.deg*(o+1),t=.08*e.alternates.length+"s";return{transform:"rotate(-"+n+"deg)",transitionDuration:t}},e.setRotation=function(r){var o=e.deg*(r+1),n="0 -"+e.size+"em",t=e.alternates.length-r,s=.08*r+"s";return r+1===e.alternates.length&&(o=360,n="0 -"+e.size+"em 0 0",t=e.alternates.length),{transform:"rotate("+o+"deg)",margin:n,transitionDelay:s,zIndex:t}},e.doIt=function(){i()},e.saveColor=function(o){var t=r.findIndex(e.myColors,function(e){return e===o});t>-1?e.myColors.splice(t,1):e.myColors.push(o),n.save("tanuki-colors",e.myColors)},e.shareColors=function(){var o="";r.each(e.myColors,function(e){o+="\n"+e+"\n"}),window.location.href="mailto:?subject=Colors&body="+encodeURIComponent(o)},e.isSaved=function(o){return r.find(e.myColors,function(e){return e===o})},e.loadColor=function(r){e.preferences.useHash?window.location.hash=r.toLowerCase().replace("#","#/"):i(r)},e.setClasses=function(e,r,o){if(e){var n=[];if(o){var s=t.colorBrightness(e)<155?"fg-light":"fg-dark";n.push(s)}return e===r&&n.push("current"),n.join(" ")}},e.$watch(function(){var e=window.location.hash;return e?e.replace("/",""):""},function(e){i(e)}),e.$watch("useHash",function(r){e.preferences.useHash=r,n.save("tanuki-preferences",e.preferences)}),e.$watch("showHistory",function(r){e.preferences.showHistory=r,n.save("tanuki-preferences",e.preferences)}),$(window.document).on("keyup",function(e){32===e.keyCode&&i()})}])}(window.angular,window._);