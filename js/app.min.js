!function(e,r){"use strict";angular.module("app",["jamfu","ui.sortable"]).controller("AppController",["$scope","$location","StorageService","UtilityService",function(e,o,t,n){e.headline="Itchy Tanuki",e.icon="circle-o",e.colorHistory=t.get("tanuki-history")||[],e.myColors=t.get("tanuki-colors")||[],e.preferences=t.get("tanuki-preferences")||{useHash:!1,showHistory:!1,alwaysShowHex:!1,tanukiMode:!1},e.useHash=e.preferences.useHash,e.showHistory=e.preferences.showHistory,e.showMenu=!1,e.showSliders=!1,e.tanukiMode=e.preferences.tanukiMode,e.colorSteps=e.tanukiMode?3:5,e.sortableOptions={placeholder:"color-brick parking-spot",tolerance:"pointer",stop:function(){var o=r.clone(e.myColors),n=r.map(o,function(e){return e});e.$apply(),e.myColors=r.compact(n),t.save("tanuki-colors",e.myColors)}};var s=function l(){return!e.$root.$$phase},a=function(o,n){var s=r.find(o,function(e){return e===n});s!==n&&o.push(n),e.colorHistory=r.last(o,25),t.save("tanuki-history",e.colorHistory)};e.clearColorHistory=function(){e.colorHistory=[],t.save("tanuki-history",e.colorHistory)},e.clearSavedColors=function(){e.myColors=[],t.save("tanuki-colors",e.myColors)};var i=function(o){o=o?o.toLowerCase():n.randomHexColor().toLowerCase(),a(e.colorHistory,o);var t=n.colorBrightness(o),i=[];r.times(50,function(r){if(r%e.colorSteps===0){var s=o.darken(r);t<e.colorSteps?i.push(s):t-n.colorBrightness(s)>e.colorSteps&&i.push(s)}});var c=[];r.times(50,function(r){if(r%e.colorSteps===0){var t=50-r;c.push(o.lighten(t))}}),e.darker=r.unique(i),e.lighter=r.unique(c),e.lightest=r.first(e.lighter),e.darkest=r.last(e.darker),e.alternates=r.unique(e.lighter.concat([o]).concat(e.darker)),window.console.log(e.alternates),e.tanukiMode||e.alternates.push(e.darkest),e.deg=360/(e.alternates.length-1),e.size=Math.floor((100/(e.alternates.length-1)+Math.PI)/2),e.color=o,e.tuner={r:o.red(),g:o.green(),b:o.blue(),hex:o,brightness:t},e.brightness=t,e.controlBg=r.first(e.darker),e.controlFg=r.last(e.lighter),e.accent=e.alternates[e.alternates.length-4];var l=r.findIndex(e.alternates,function(r){return r===e.color});if(e.ringDeg=e.deg*(l+1),e.preferences.useHash&&(window.location.hash=o.replace("#","#/")),s())try{e.$apply()}catch(u){}},c=function(e,r){var o=e.b|e.g<<8|e.r<<16|1<<24;return(r?"#":"")+o.toString(16).substring(1,8)};e.setNewColor=function(r){e.tuner.hex=c(r,!0),e.tuner.brightness=n.colorBrightness(e.tuner.hex),i(e.tuner.hex)},e.$watch("tuner",function(e,r){return e&&e!==r?(e.hex=c(e,!0),e.brightness=n.colorBrightness(e.hex),e.hex):void 0},!0),r.mixin({clamp2:function(e,r,o){return Math.min(Math.max(e,r),o)}}),e.setRingRotation=function(){var r=.08*(e.alternates.length-2)+"s";return{transform:"rotate3d(0,0,1,-"+e.ringDeg+"deg)",transitionDuration:r}},e.setRotation=function(r){var o=e.deg*(r+1),t="0 -"+e.size+"em",n=e.tanukiMode?r:e.alternates.length-r,s=.08*r+"s",a="";if(e.tanukiMode){var i=-(Math.E*(.01*Math.ceil(r/2))-Math.ceil(r/2));a=" scale3d("+i+", "+i+", 1)"}return e.tanukiMode||r+1!==e.alternates.length||(o=360,t="0 -"+e.size+"em 0 0",n=e.alternates.length),{transform:"rotate3d(0,0,1,"+o+"deg)"+a,margin:t,transitionDelay:s,zIndex:n}},e.setRotationClasses=function(r){var o=Math.abs(e.ringDeg-e.deg*(r+1));return o>90&&270>o?"flip-my-hex":""},e.doIt=function(){i()},e.saveColor=function(o){var n=r.findIndex(e.myColors,function(e){return e===o});n>-1?e.myColors.splice(n,1):e.myColors.push(o),t.save("tanuki-colors",e.myColors)},e.shareColors=function(){var o="";r.each(e.myColors,function(e){o+="\n"+e+"\n"}),window.location.href="mailto:?subject=Colors&body="+encodeURIComponent(o)},e.isSaved=function(o){return r.find(e.myColors,function(e){return e===o})},e.loadColor=function(r){e.preferences.useHash?window.location.hash=r.toLowerCase().replace("#","#/"):i(r)},e.setClasses=function(e,r,o){if(e){var t=[];if(o){var s=n.colorBrightness(e)<155?"fg-light":"fg-dark";t.push(s)}return e===r&&t.push("current"),t.join(" ")}},e.$watch(function(){var e=window.location.hash;return e?e.replace("/",""):""},function(e){i(e)}),e.$watch("colorSteps",function(r,o){r&&r!==o&&i(e.color)},!0),e.$watch("useHash",function(r){e.preferences.useHash=r,t.save("tanuki-preferences",e.preferences)}),e.$watch("showHistory",function(r){e.preferences.showHistory=r,t.save("tanuki-preferences",e.preferences)}),e.$watch("alwaysShowHex",function(r){e.preferences.alwaysShowHex=r,t.save("tanuki-preferences",e.preferences)}),e.$watch("moreSteps",function(r){e.preferences.moreSteps=r,t.save("tanuki-preferences",e.preferences)}),e.$watch("tanukiMode",function(r){e.preferences.tanukiMode=r,t.save("tanuki-preferences",e.preferences),e.colorSteps=r?3:5}),$(window.document).on("keyup",function(e){32===e.keyCode&&i()})}])}(window.angular,window._);