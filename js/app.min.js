!function(e,r,o){"use strict";e.module("app",["picardy.fontawesome","as.sortable"]).directive("tap",[function(){return function(e,r,n){var t=new o(r[0],{});t.on("tap",function(){e.$apply(function(){e.$eval(n.tap)})})}}]).factory("LocalStorage",[function(){var o=function(o){var n,t=window.localStorage.getItem(o);return n=t&&r.isString(t)&&r.isEmpty(t)===!1?e.fromJson(t):t},n=function(r,o){window.localStorage.setItem(r,e.toJson(o))},t=function(e){window.localStorage.removeItem(e)},a=function(){window.localStorage.clear()};return{get:o,save:n,remove:t,clearAll:a}}]).factory("UiHelpers",[function(){var e=359,r=6.283185307179586,o=function(e){var r={};return e&&(r={t:e.offsetTop,r:e.offsetLeft+e.offsetWidth,b:e.offsetTop+e.offsetHeight,l:e.offsetLeft,w:e.offsetWidth,h:e.offsetHeight},r.cx=r.l+r.w/2,r.cy=r.t+r.h/2),r},n=function(e,n){var t=o(n),a=Math.atan2(e.clientY-t.cy,e.clientX-t.cx);return a+=r/4,0>a&&(a+=r),a},t=function(e,r){var o=n(e,r),t=180*o/Math.PI;return t};return{maxRadians:r,maxDegrees:e,getNumbers:o,getRadians:n,getDegrees:t}}]).controller("AppController",["$scope","$location","$document","LocalStorage","ColorService","UiHelpers",function(n,t,a,s,i,c){r.mixin({clamp2:function(e,r,o){return Math.min(Math.max(e,r),o)}});var l=[{name:"tanuki",icon:"spinner"},{name:"florix",icon:"sun-o"},{name:"blook",icon:"square"}],u={useHash:!1,allowBW:!1,showHistory:!1,showFavs:!1,alwaysShowHex:!1,mode:l[1].name,toolbox:"color",fancy:!0,tweeks:{tanuki:{klumpf:2,ichtzy:5,flarp:100,plark:1,marklar:.01,quarble:.08,cappa:!0},florix:{quarble:0,borgee:50,gloosh:100,zarrt:12,syrris:100,shaado:5,shaada:-1,shaadik:0},blook:{quarble:.04}}},f=function(e,r){return r=r||255,i.rgbObjToHex({r:Math.round(e*r),g:Math.round(e*r),b:Math.round(e*r)},!0)};n.colorHistory=s.get("tanuki-history")||[],n.myColors=s.get("tanuki-colors")||[],n.modes=l,n.preferences=s.get("tanuki-preferences")||u,n.showMenu=!1,n.showSliders=!1,n.tab="color",n.touching=!1,n.colorSteps=6,n.mode=r.findWhere(l,{name:n.preferences.mode}),n.kulra=f(n.preferences.tweeks.florix.shaadik,255),n.sortableOptions={containerPositioning:"relative",additionalPlaceholderClass:"color-brick parking-spot",dragEnd:function(){var e=r.clone(n.myColors),o=r.map(e,function(e){return e});n.myColors=r.compact(o),s.save("tanuki-colors",n.myColors)}};var h=function T(){return!n.$root.$$phase},d=function(e,o){var t=r.find(e,function(e){return e===o});t!==o&&e.push(o),n.colorHistory=r.last(e,20),s.save("tanuki-history",n.colorHistory)};n.cycleModes=function(e){n.preferences.showFavs||("blook"===e?n.preferences.mode="tanuki":"florix"===e?n.preferences.mode="blook":n.preferences.mode="florix",n.mode=r.findWhere(l,{name:n.preferences.mode}))},n.clearColorHistory=function(){n.colorHistory=[],s.save("tanuki-history",n.colorHistory)},n.clearSavedColors=function(){n.myColors=[],s.save("tanuki-colors",n.myColors)},n.clearPrefs=function(){s.remove("tanuki-preferences"),s.save("tanuki-preferences",e.copy(u)),window.location.reload()},n.resetTweeks=function(r){n.preferences.tweeks[r]=e.copy(u.tweeks[r])};var p=function(e){e&&"#"!==e||(e=i.randomHex()),e=i.toHex(e).toLowerCase(),d(n.colorHistory,e);var o=i.brightness(e),t=[];r.times(50,function(r){if(r%n.colorSteps===0){var a=i.darken(e,r);("#000000"!==a||n.preferences.allowBW)&&(o<n.colorSteps?t.push(a):o-i.brightness(a)>n.colorSteps&&t.push(a))}});var a=[];if(r.times(50,function(r){if(r%n.colorSteps===0){var o=50-r,t=i.lighten(e,o);("#ffffff"!==t||n.preferences.allowBW)&&a.push(t)}}),n.darker=r.unique(t),n.lighter=r.unique(a),n.lightest=r.first(n.lighter),n.darkest=r.last(n.darker),n.lightish=n.lighter.length>2?n.lighter[n.lighter.length-3]:e,n.darkish=n.darker.length>2?n.darker[2]:e,n.alternates=r.unique(n.lighter.concat([e]).concat(n.darker)),"florix"===n.preferences.mode&&(n.darkest||(n.darkest=e),n.alternates.push(n.darkest)),n.controlBg=r.first(n.darker),n.controlFg=r.last(n.lighter),n.deg=360/(n.alternates.length-1),n.size=Math.floor((100/(n.alternates.length-2)+Math.PI)/2),n.color=e,n.tuner={r:i.red(e),g:i.green(e),b:i.blue(e),hex:e,brightness:o},n.rotateFactor=r.findIndex(n.alternates,function(e){return e===n.color}),n.ringDeg=n.deg*(n.rotateFactor+1),n.preferences.useHash&&(window.location.hash=e.replace("#","#/")),h())try{n.$apply()}catch(s){}};n.doIt=function(e){p(e)},n.setNewColor=function(e){n.tuner.hex=i.rgbObjToHex(e,!0),n.tuner.brightness=i.brightness(n.tuner.hex),p(n.tuner.hex)},n.setRingRotation=function(){return{transform:"rotate(-"+n.ringDeg+"deg) translateZ(0)"}},n.setRotation=function(e){var r=e+1,o=n.deg*r,t="0 -"+n.size+"em",a="tanuki"===n.preferences.mode?r:n.alternates.length-r,s=r*parseFloat(n.preferences.tweeks[n.preferences.mode].quarble),i="",c="",l="",u;return"tanuki"===n.preferences.mode&&(u=n.preferences.tweeks.tanuki.cappa?-(Math.E*(Math.ceil(r/n.preferences.tweeks.tanuki.klumpf)*n.preferences.tweeks.tanuki.marklar)-Math.ceil(r/n.preferences.tweeks.tanuki.klumpf)):-(Math.E*(r/n.preferences.tweeks.tanuki.klumpf*n.preferences.tweeks.tanuki.marklar-r/n.preferences.tweeks.tanuki.klumpf)),c=" scale("+u*n.preferences.tweeks.tanuki.plark+")",l="-"+u+"vmax",t=""),"florix"===n.preferences.mode&&r===n.alternates.length&&(o=360,t="0 -"+n.size+"em 0 0",a=n.alternates.length),i="rotate("+o+"deg)",{transform:i+c,fontSize:l,margin:t,transitionDelay:s+"s",zIndex:a}},n.setRotationClasses=function(e){var r=Math.abs(n.ringDeg-n.deg*(e+1));return r>90&&270>r?"flip-my-hex":""};var g=function(e,r,o){var t=o/2,a=e-Math.floor(Math.abs(r-t)/o);window.console.log(r,a);var s=e-a;return s=0>s?0:s>e?e:s,x=n.alternates[s],n.tuner={r:i.red(x),g:i.green(x),b:i.blue(x),hex:x,brightness:i.brightness(x)},n.color=x,s},m=e.element(window.document.querySelector(".canvas")),k=e.element(window.document.querySelector(".color-ring")),w,v,y,b,x,C,H=0,S=0,M,D,I,E=new o(m[0],{});E.get("pan").set({direction:o.DIRECTION_ALL,threshold:0}),E.on("panstart",function(e){v=n.alternates.length-1,y=360/v,w=e.srcEvent&&e.srcEvent.changedTouches?e.srcEvent.changedTouches:e.pointers,H=-c.getDegrees(w[0],m[0]),S=n.ringDeg}).on("pan panmove",function(e){w=e.srcEvent&&e.srcEvent.changedTouches?e.srcEvent.changedTouches:e.pointers,M=-c.getDegrees(w[0],m[0]),D=M-H,I=S+D,isNaN(I)&&(I=S),0>I&&(I=c.maxDegrees),I>c.maxDegrees&&(I=0),H=M,k.css({transform:"rotate(-"+I+"deg) translateZ(0)",transitionDuration:"0s"}),b=g(v,I,y),S=I,n.$apply()}).on("panend pancancel",function(){C=y*(b+1),window.console.log(">> d",y,b,C),n.ringDeg=C,k.css({transitionDuration:""}),n.$apply()}),n.saveColor=function(e){var o=r.findIndex(n.myColors,function(r){return r===e});o>-1?n.myColors.splice(o,1):n.myColors.push(e),s.save("tanuki-colors",n.myColors)},n.shareColors=function(){var e="";r.each(n.myColors,function(r){e+="\n"+r+"\n"}),window.location.href="mailto:?subject=Colors&body="+encodeURIComponent(e)},n.isSaved=function(e){return r.find(n.myColors,function(r){return r===e})},n.loadColor=function(e){n.preferences.useHash?window.location.hash=e.toLowerCase().replace("#","#/"):p(e)},n.setClasses=function(e,r,o){if(e){var n=[];if(o){var t=i.brightness(e)<155?"fg-light":"fg-dark";n.push(t)}return e===r&&n.push("current"),n.join(" ")}},n.hash=window.location.hash?window.location.hash.replace("/",""):"",n.$watch("hash",function(e){p(e)}),n.$watch("tuner",function(e,r){return e&&e!==r?(e.hex=i.rgbObjToHex(e,!0),e.brightness=i.brightness(e.hex),e.hex):void 0},!0),n.$watch("colorSteps",function(e,r){e&&e!==r&&p(n.color)}),n.$watch("preferences",function(e,r){e&&r&&e!==r&&(n.savePrefs=e,(e.mode!==r.mode||e.allowBW!==r.allowBW)&&p(n.color),e.tweeks.florix.shaadik!==r.tweeks.florix.shaadik&&(n.kulra=f(e.tweeks.florix.shaadik,255)))},!0),n.$watch("savePrefs",r.debounce(function(e){e&&s.save("tanuki-preferences",e)},500),!0),a.on("keyup",function(e){32===e.keyCode&&p(),27===e.keyCode&&(n.showMenu=!1,n.showSliders=!1,n.preferences.showFavs=!1,n.preferences.showHistory=!1,n.$apply())})}])}(window.angular,window._,window.Hammer);