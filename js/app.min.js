!function(e,r,t){"use strict";e.module("app",["picardy.fontawesome","as.sortable"]).directive("tap",[function(){return function(e,r,o){var n=new t(r[0],{});n.on("tap",function(){e.$apply(function(){e.$eval(o.tap)})})}}]).factory("LocalStorage",[function(){var t=function(t){var o,n=window.localStorage.getItem(t);return o=n&&r.isString(n)&&r.isEmpty(n)===!1?e.fromJson(n):n},o=function(r,t){window.localStorage.setItem(r,e.toJson(t))},n=function(e){window.localStorage.removeItem(e)},a=function(){window.localStorage.clear()};return{get:t,save:o,remove:n,clearAll:a}}]).factory("UiHelpers",[function(){var e=function(e){var r={};return e&&(r={t:e.offsetTop,r:e.offsetLeft+e.offsetWidth,b:e.offsetTop+e.offsetHeight,l:e.offsetLeft,w:e.offsetWidth,h:e.offsetHeight},r.cx=r.l+r.w/2,r.cy=r.t+r.h/2),r},r=function(r,t){var o=e(t),n=Math.atan2(r.clientY-o.cy,r.clientX-o.cx),a=Math.round(180*n/Math.PI);return a};return{getNumbers:e,getDegree:r}}]).controller("AppController",["$scope","$location","$document","LocalStorage","ColorService","UiHelpers",function(o,n,a,s,i,c){r.mixin({clamp2:function(e,r,t){return Math.min(Math.max(e,r),t)}});var l=[{name:"tanuki",icon:"spinner"},{name:"florix",icon:"sun-o"},{name:"blook",icon:"square"}],u={useHash:!1,allowBW:!1,showHistory:!1,showFavs:!1,alwaysShowHex:!1,mode:l[1].name,toolbox:"color",fancy:!0,tweeks:{tanuki:{klumpf:2,ichtzy:5,flarp:100,plark:1,marklar:.01,quarble:.08,cappa:!0},florix:{quarble:0,borgee:50,gloosh:100,zarrt:12,syrris:100,shaado:5,shaada:-1,shaadik:0},blook:{quarble:.04}}},f=function(e,r){return r=r||255,i.rgbObjToHex({r:Math.round(e*r),g:Math.round(e*r),b:Math.round(e*r)},!0)};o.colorHistory=s.get("tanuki-history")||[],o.myColors=s.get("tanuki-colors")||[],o.modes=l,o.preferences=s.get("tanuki-preferences")||u,o.showMenu=!1,o.showSliders=!1,o.tab="color",o.touching=!1,o.colorSteps=5,o.mode=r.findWhere(l,{name:o.preferences.mode}),o.kulra=f(o.preferences.tweeks.florix.shaadik,255),o.sortableOptions={containerPositioning:"relative",containment:".palette",additionalPlaceholderClass:"color-brick parking-spot",dragEnd:function(){var e=r.clone(o.myColors),t=r.map(e,function(e){return e});o.myColors=r.compact(t),s.save("tanuki-colors",o.myColors)}};var h=function S(){return!o.$root.$$phase},p=function(e,t){var n=r.find(e,function(e){return e===t});n!==t&&e.push(t),o.colorHistory=r.last(e,20),s.save("tanuki-history",o.colorHistory)};o.cycleModes=function(e){o.preferences.showFavs||("blook"===e?o.preferences.mode="tanuki":"florix"===e?o.preferences.mode="blook":o.preferences.mode="florix",o.mode=r.findWhere(l,{name:o.preferences.mode}))},o.clearColorHistory=function(){o.colorHistory=[],s.save("tanuki-history",o.colorHistory)},o.clearSavedColors=function(){o.myColors=[],s.save("tanuki-colors",o.myColors)},o.clearPrefs=function(){s.remove("tanuki-preferences"),s.save("tanuki-preferences",e.copy(u)),window.location.reload()},o.resetTweeks=function(r){o.preferences.tweeks[r]=e.copy(u.tweeks[r])};var d=function(e){e&&"#"!==e||(e=i.randomHex()),e=i.toHex(e).toLowerCase(),p(o.colorHistory,e);var t=i.brightness(e),n=[];r.times(50,function(r){if(r%o.colorSteps===0){var a=i.darken(e,r);("#000000"!==a||o.preferences.allowBW)&&(t<o.colorSteps?n.push(a):t-i.brightness(a)>o.colorSteps&&n.push(a))}});var a=[];if(r.times(50,function(r){if(r%o.colorSteps===0){var t=50-r,n=i.lighten(e,t);("#ffffff"!==n||o.preferences.allowBW)&&a.push(n)}}),o.darker=r.unique(n),o.lighter=r.unique(a),o.lightest=r.first(o.lighter),o.darkest=r.last(o.darker),o.lightish=o.lighter.length>2?o.lighter[o.lighter.length-3]:e,o.darkish=o.darker.length>2?o.darker[2]:e,o.alternates=r.unique(o.lighter.concat([e]).concat(o.darker)),"florix"===o.preferences.mode&&(o.darkest||(o.darkest=e),o.alternates.push(o.darkest)),o.deg=360/(o.alternates.length-1),o.size=Math.floor((100/(o.alternates.length-2)+Math.PI)/2),o.color=e,o.tuner={r:i.red(e),g:i.green(e),b:i.blue(e),hex:e,brightness:t},o.brightness=t,o.controlBg=r.first(o.darker),o.controlFg=r.last(o.lighter),o.accent=o.alternates[o.alternates.length-4],o.rotateFactor=r.findIndex(o.alternates,function(e){return e===o.color}),o.ringDeg=o.deg*(o.rotateFactor+1),o.preferences.useHash&&(window.location.hash=e.replace("#","#/")),h())try{o.$apply()}catch(s){}};o.doIt=function(e){d(e)},o.setNewColor=function(e){o.tuner.hex=i.rgbObjToHex(e,!0),o.tuner.brightness=i.brightness(o.tuner.hex),d(o.tuner.hex)},o.setRingRotation=function(){return{transform:"rotate(-"+o.ringDeg+"deg) translateZ(0)"}},o.setRotation=function(e){var r=e+1,t=o.deg*r,n="0 -"+o.size+"em",a="tanuki"===o.preferences.mode?r:o.alternates.length-r,s=r*parseFloat(o.preferences.tweeks[o.preferences.mode].quarble),i="",c="",l="",u;return"tanuki"===o.preferences.mode&&(u=o.preferences.tweeks.tanuki.cappa?-(Math.E*(Math.ceil(r/o.preferences.tweeks.tanuki.klumpf)*o.preferences.tweeks.tanuki.marklar)-Math.ceil(r/o.preferences.tweeks.tanuki.klumpf)):-(Math.E*(r/o.preferences.tweeks.tanuki.klumpf*o.preferences.tweeks.tanuki.marklar-r/o.preferences.tweeks.tanuki.klumpf)),c=" scale("+u*o.preferences.tweeks.tanuki.plark+")",l="-"+u+"vmax",n=""),"florix"===o.preferences.mode&&r===o.alternates.length&&(t=360,n="0 -"+o.size+"em 0 0",a=o.alternates.length),i="rotate("+t+"deg)",{transform:i+c,fontSize:l,margin:n,transitionDelay:s+"s",zIndex:a}},o.setRotationClasses=function(e){var r=Math.abs(o.ringDeg-o.deg*(e+1));return r>90&&270>r?"flip-my-hex":""};var g=e.element(window.document.querySelector(".canvas")),m=e.element(window.document.querySelector(".color-ring")),k=new t(g[0],{}),w,v,y,b,x,C,H;k.get("pan").set({direction:t.DIRECTION_ALL,threshold:0}),k.on("panstart",function(e){v=o.alternates.length-1,y=360/v}).on("pan panmove",function(e){w=e.srcEvent&&e.srcEvent.changedTouches?e.srcEvent.changedTouches:e.pointers,b=360-o.deg-c.getDegree(w[0],g[0]),b=b>=360?b-360:-360>=b?b+360:b,x=v-Math.floor(Math.abs(b)/y),C=v-x,C=0>C?0:C>v?v:C,H=o.alternates[C],o.tuner={r:i.red(H),g:i.green(H),b:i.blue(H),hex:H,brightness:i.brightness(H)},o.color=H,o.brightness=o.tuner.brightness,m.css({transform:"rotate("+-b+"deg) translateZ(0)",transitionDuration:"0s"}),o.$apply()}).on("panend pancancel",function(e){}),o.saveColor=function(e){var t=r.findIndex(o.myColors,function(r){return r===e});t>-1?o.myColors.splice(t,1):o.myColors.push(e),s.save("tanuki-colors",o.myColors)},o.shareColors=function(){var e="";r.each(o.myColors,function(r){e+="\n"+r+"\n"}),window.location.href="mailto:?subject=Colors&body="+encodeURIComponent(e)},o.isSaved=function(e){return r.find(o.myColors,function(r){return r===e})},o.loadColor=function(e){o.preferences.useHash?window.location.hash=e.toLowerCase().replace("#","#/"):d(e)},o.setClasses=function(e,r,t){if(e){var o=[];if(t){var n=i.brightness(e)<155?"fg-light":"fg-dark";o.push(n)}return e===r&&o.push("current"),o.join(" ")}},o.hash=window.location.hash?window.location.hash.replace("/",""):"",o.$watch("hash",function(e){d(e)}),o.$watch("tuner",function(e,r){return e&&e!==r?(e.hex=i.rgbObjToHex(e,!0),e.brightness=i.brightness(e.hex),e.hex):void 0},!0),o.$watch("colorSteps",function(e,r){e&&e!==r&&d(o.color)}),o.$watch("preferences",function(e,r){e&&r&&e!==r&&(o.savePrefs=e,(e.mode!==r.mode||e.allowBW!==r.allowBW)&&d(o.color),e.tweeks.florix.shaadik!==r.tweeks.florix.shaadik&&(o.kulra=f(e.tweeks.florix.shaadik,255)))},!0),o.$watch("savePrefs",r.debounce(function(e){e&&s.save("tanuki-preferences",e)},500),!0),a.on("keyup",function(e){32===e.keyCode&&d(),27===e.keyCode&&(o.showMenu=!1,o.showSliders=!1,o.preferences.showFavs=!1,o.preferences.showHistory=!1,o.$apply())})}])}(window.angular,window._,window.Hammer);