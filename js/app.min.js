!function(e,o,r){"use strict";e.module("app",["picardy.fontawesome","as.sortable"]).directive("tap",[function(){return function(e,o,n){var t=new r(o[0],{});t.on("tap",function(){e.$apply(function(){e.$eval(n.tap)})})}}]).directive("colorPan",["UiHelpers",function(o){return{controller:["$scope","ColorService","UiHelpers",function(o,n,t){var s=e.element(window.document.querySelector(".canvas")),a=e.element(window.document.querySelector(".color-ring")),i,c,l,u={},h,f=0,d=0,p,g,k,m=new r(s[0],{});m.get("pan").set({direction:r.DIRECTION_ALL,threshold:0}),m.on("panstart",function e(r){c=o.shades.length-1,l=360/c,i=r.srcEvent&&r.srcEvent.changedTouches?r.srcEvent.changedTouches:r.pointers,f=-t.getDegrees(i[0],s[0]),d=o.ringDeg}).on("pan panmove",function e(r){i=r.srcEvent&&r.srcEvent.changedTouches?r.srcEvent.changedTouches:r.pointers,p=-t.getDegrees(i[0],s[0]),g=p-f,k=d+g,k=isNaN(k)?d:k,k=k<=0?t.maxDegrees-Math.abs(k):k,k=k>=t.maxDegrees?k-t.maxDegrees:k,f=p,a.css({transform:"rotate(-"+k+"deg) translateZ(0)",transitionDuration:"0s"}),u=t.getColorByDegree(o.shades,c,k,l),o.tuner=u.tuner,o.color=t.setColor(u.color,o.color,!1,!0),d=k,o.$apply()}).on("panend pancancel",function e(){h=l*(u.key+1),o.ringDeg=h,a.css({transitionDuration:""}),o.$apply()})}]}}]).controller("app",["$scope","$document","LocalStorage","ColorService","UiHelpers",function(r,n,t,s,a){var i=[{name:"tanuki",icon:"spinner"},{name:"florix",icon:"sun-o"},{name:"blook",icon:"square"}],c={useHash:!1,allowBW:!1,showHistory:!1,showFavs:!1,showToolbox:!1,showMenu:!1,alwaysShowHex:!1,mode:i[1].name,toolbox:"color",defaultColor:null,fancy:!0,tweeks:{tanuki:{klumpf:2,ichtzy:5,flarp:100,plark:1,marklar:.01,quarble:.08,cappa:!0},florix:{quarble:.08,borgee:50,gloosh:100,zarrt:12,syrris:100,shaado:5,shaada:-1,shaadik:0},blook:{quarble:.04}}},l=function e(o,r){return r=r||255,s.rgbObjToHex({r:Math.round(o*r),g:Math.round(o*r),b:Math.round(o*r)},!0)},u=function e(o){32===o.which&&r.doIt(),27===o.which&&(r.preferences.showMenu=!1,r.preferences.showToolbox=!1,r.preferences.showFavs=!1,r.preferences.showHistory=!1,r.$apply())},h=function e(){return!r.$root.$$phase},f=function e(){return window.location.hash},d=function e(){var a=f();r.colorHistory=t.get("tanuki-history")||[],r.myColors=t.get("tanuki-colors")||[],r.modes=i,r.preferences=t.get("tanuki-preferences")||c,r.tab="color",r.touching=!1,r.colorSteps=6,r.mode=o.findWhere(i,{name:r.preferences.mode}),r.kulra=l(r.preferences.tweeks.florix.shaadik,255),s.isValidHex(a)||(a=r.preferences.defaultColor),window.console.log("init",a),n.on("keyup",u),r.$on("$destroy",function(){n.off("keyup",u)}),r.sortableOptions={containerPositioning:"relative",containment:".palette",additionalPlaceholderClass:"color-brick parking-spot",dragEnd:function(){var e=o.clone(r.myColors),n=o.map(e,function(e){return e});r.myColors=o.compact(n),t.save("tanuki-colors",r.myColors)}},r.doIt(a)},p=function e(n,s){var a=o.find(n,function(e){return e===s});a!==s&&n.push(s),r.colorHistory=o.last(n,20),t.save("tanuki-history",r.colorHistory)};r.cycleModes=function e(n){r.preferences.showFavs||("blook"===n?r.preferences.mode="tanuki":"florix"===n?r.preferences.mode="blook":r.preferences.mode="florix",r.mode=o.findWhere(i,{name:r.preferences.mode}))},r.clearColorHistory=function e(){r.colorHistory=[],t.save("tanuki-history",r.colorHistory)},r.clearSavedColors=function e(){r.myColors=[],t.save("tanuki-colors",r.myColors)},r.clearPrefs=function o(){t.remove("tanuki-preferences"),t.save("tanuki-preferences",e.copy(c)),window.location.reload()},r.resetTweeks=function o(n){r.preferences.tweeks[n]=e.copy(c.tweeks[n])},r.doIt=function e(n){n=s.isValidHex(n)?s.toHex(n).toLowerCase():s.randomHex().toLowerCase(),p(r.colorHistory,n);var t=s.brightness(n),i=[];o.times(50,function(e){if(e%r.colorSteps===0){var o=s.darken(n,e);("#000000"!==o||r.preferences.allowBW)&&(t<r.colorSteps?i.push(o):t-s.brightness(o)>r.colorSteps&&i.push(o))}});var c=[];if(o.times(50,function(e){if(e%r.colorSteps===0){var o=50-e,t=s.lighten(n,o);("#ffffff"!==t||r.preferences.allowBW)&&c.push(t)}}),r.darker=o.unique(i),r.lighter=o.unique(c),r.lightest=o.first(r.lighter),r.darkest=o.last(r.darker),r.lightish=r.lighter.length>2?r.lighter[r.lighter.length-3]:n,r.darkish=r.darker.length>2?r.darker[2]:n,r.shades=o.unique(r.lighter.concat([n]).concat(r.darker)),"florix"===r.preferences.mode&&(r.darkest||(r.darkest=n),r.shades.push(r.darkest)),r.controlBg=o.first(r.darker),r.controlFg=o.last(r.lighter),r.deg=360/(r.shades.length-1),r.size=Math.floor((100/(r.shades.length-2)+Math.PI)/2),r.color=n,r.tuner={r:s.red(n),g:s.green(n),b:s.blue(n),hex:n,brightness:t},r.rotateFactor=o.findIndex(r.shades,function(e){return e===n}),r.ringDeg=r.deg*(r.rotateFactor+1),r.color=a.setColor(n,r.color,r.preferences.useHash),h())try{r.$apply()}catch(e){}},r.setNewColor=function e(o){r.tuner.hex=s.rgbObjToHex(o,!0),r.tuner.brightness=s.brightness(r.tuner.hex),r.doIt(r.tuner.hex)},r.setRingRotation=function e(){return{transform:"rotate(-"+r.ringDeg+"deg) translateZ(0)"}},r.setRotation=function e(o){var n=o+1,t=r.deg*n,s="0 -"+r.size+"em",a="tanuki"===r.preferences.mode?n:r.shades.length-n,i=n*parseFloat(r.preferences.tweeks[r.preferences.mode].quarble),c="",l="",u="",h;return"tanuki"===r.preferences.mode&&(h=r.preferences.tweeks.tanuki.cappa?-(Math.E*(Math.ceil(n/r.preferences.tweeks.tanuki.klumpf)*r.preferences.tweeks.tanuki.marklar)-Math.ceil(n/r.preferences.tweeks.tanuki.klumpf)):-(Math.E*(n/r.preferences.tweeks.tanuki.klumpf*r.preferences.tweeks.tanuki.marklar-n/r.preferences.tweeks.tanuki.klumpf)),l=" scale("+h*r.preferences.tweeks.tanuki.plark+")",u="-"+h+"vmax",s=""),"florix"===r.preferences.mode&&n===r.shades.length&&(t=360,s="0 -"+r.size+"em 0 0",a=r.shades.length),c="rotate("+t+"deg)",{transform:c+l,fontSize:u,margin:s,transitionDelay:i+"s",zIndex:a}},r.setRotationClasses=function e(o){var n=Math.abs(r.ringDeg-r.deg*(o+1));return n>90&&n<270?"flip-my-hex":""};var g=function e(o,n,t){var a=t/2,i=o-Math.floor(Math.abs(n-a)/t),c=o-i,l;return c=c<0?0:c>o?o:c,l=r.shades[c],r.tuner={r:s.red(l),g:s.green(l),b:s.blue(l),hex:l,brightness:s.brightness(l)},{color:l,key:c}};r.saveColor=function e(n){var s=o.findIndex(r.myColors,function(e){return e===n});s>-1?r.myColors.splice(s,1):(r.myColors.push(n),r.doIt(n)),t.save("tanuki-colors",r.myColors)},r.shareColors=function e(){var n="";o.each(r.myColors,function(e){n+="\n"+e+"\n"}),window.location.href="mailto:?subject=Colors&body="+encodeURIComponent(n)},r.isSaved=function e(n){return o.find(r.myColors,function(e){return e===n})},r.setStateClases=function e(o){if(o){var r=[];return o.showFavs&&r.push("favorites-active"),o.fancy&&r.push("fancy"),o.alwaysShowHex&&r.push("always-show-hex"),o.showMenu&&r.push("menu-active"),o.showToolbox&&r.push("toolbox-active"),o.showHistory&&r.push("history-active"),r.join(" ")}},r.setClasses=function e(o,r,n){if(o){var t=[];return n&&t.push(s.brightness(o)<155?"fg-light":"fg-dark"),o===r&&t.push("current"),t.join(" ")}},r.$watch("tuner",function(e,o){if(e&&e!==o)return e.hex=s.rgbObjToHex(e,!0),e.brightness=s.brightness(e.hex),e.hex},!0),r.$watch("colorSteps",function(e,o){e&&e!==o&&r.doIt(r.color)}),r.$watch("preferences",function(e,o){e&&o&&e!==o&&(r.savePrefs=e,e.mode===o.mode&&e.allowBW===o.allowBW||r.doIt(r.color),e.tweeks.florix.shaadik!==o.tweeks.florix.shaadik&&(r.kulra=l(e.tweeks.florix.shaadik,255)),e.useHash!==o.useHash&&(r.color=a.setColor(r.color,r.color,e.useHash,!e.useHash)))},!0),r.$watch("savePrefs",o.debounce(function(e){e&&t.save("tanuki-preferences",e)},500),!0),window.onpopstate=function(){var e=f();s.isValidHex(e)&&r.doIt(e)},d()}])}(window.angular,window._,window.Hammer);