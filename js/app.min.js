!function(e,r,t){"use strict";e.module("app",["picardy.fontawesome","as.sortable"]).directive("tap",[function(){return function(e,r,n){var o=new t(r[0],{});o.on("tap",function(){e.$apply(function(){e.$eval(n.tap)})})}}]).factory("LocalStorage",[function(){var t=function(t){var n,o=window.localStorage.getItem(t);return n=o&&r.isString(o)&&r.isEmpty(o)===!1?e.fromJson(o):o},n=function(r,t){window.localStorage.setItem(r,e.toJson(t))},o=function(e){window.localStorage.removeItem(e)},a=function(){window.localStorage.clear()};return{get:t,save:n,remove:o,clearAll:a}}]).factory("UiHelpers",[function(){var e=360,r=6.28318530718,t=function(e){var r={};return e&&(r={t:e.offsetTop,r:e.offsetLeft+e.offsetWidth,b:e.offsetTop+e.offsetHeight,l:e.offsetLeft,w:e.offsetWidth,h:e.offsetHeight},r.cx=r.l+r.w/2,r.cy=r.t+r.h/2),r},n=function(e,n){var o=t(n),a=Math.atan2(e.clientY-o.cy,e.clientX-o.cx);return a+=r/4,0>a&&(a+=r),a},o=function(e,r){var t=n(e,r),o=180*t/Math.PI;return o};return{maxRadians:r,maxDegrees:e,getNumbers:t,getRadians:n,getDegrees:o}}]).controller("AppController",["$scope","$location","$document","LocalStorage","ColorService","UiHelpers",function(n,o,a,s,i,c){r.mixin({clamp2:function(e,r,t){return Math.min(Math.max(e,r),t)}});var l=[{name:"tanuki",icon:"spinner"},{name:"florix",icon:"sun-o"},{name:"blook",icon:"square"}],u={useHash:!1,allowBW:!1,showHistory:!1,showFavs:!1,alwaysShowHex:!1,mode:l[1].name,toolbox:"color",fancy:!0,tweeks:{tanuki:{klumpf:2,ichtzy:5,flarp:100,plark:1,marklar:.01,quarble:.08,cappa:!0},florix:{quarble:0,borgee:50,gloosh:100,zarrt:12,syrris:100,shaado:5,shaada:-1,shaadik:0},blook:{quarble:.04}}},f=function(e,r){return r=r||255,i.rgbObjToHex({r:Math.round(e*r),g:Math.round(e*r),b:Math.round(e*r)},!0)};n.colorHistory=s.get("tanuki-history")||[],n.myColors=s.get("tanuki-colors")||[],n.modes=l,n.preferences=s.get("tanuki-preferences")||u,n.showMenu=!1,n.showSliders=!1,n.tab="color",n.touching=!1,n.colorSteps=5,n.mode=r.findWhere(l,{name:n.preferences.mode}),n.kulra=f(n.preferences.tweeks.florix.shaadik,255),n.sortableOptions={containerPositioning:"relative",containment:".palette",additionalPlaceholderClass:"color-brick parking-spot",dragEnd:function(){var e=r.clone(n.myColors),t=r.map(e,function(e){return e});n.myColors=r.compact(t),s.save("tanuki-colors",n.myColors)}};var h=function T(){return!n.$root.$$phase},p=function(e,t){var o=r.find(e,function(e){return e===t});o!==t&&e.push(t),n.colorHistory=r.last(e,20),s.save("tanuki-history",n.colorHistory)};n.cycleModes=function(e){n.preferences.showFavs||("blook"===e?n.preferences.mode="tanuki":"florix"===e?n.preferences.mode="blook":n.preferences.mode="florix",n.mode=r.findWhere(l,{name:n.preferences.mode}))},n.clearColorHistory=function(){n.colorHistory=[],s.save("tanuki-history",n.colorHistory)},n.clearSavedColors=function(){n.myColors=[],s.save("tanuki-colors",n.myColors)},n.clearPrefs=function(){s.remove("tanuki-preferences"),s.save("tanuki-preferences",e.copy(u)),window.location.reload()},n.resetTweeks=function(r){n.preferences.tweeks[r]=e.copy(u.tweeks[r])};var d=function(e){e&&"#"!==e||(e=i.randomHex()),e=i.toHex(e).toLowerCase(),p(n.colorHistory,e);var t=i.brightness(e),o=[];r.times(50,function(r){if(r%n.colorSteps===0){var a=i.darken(e,r);("#000000"!==a||n.preferences.allowBW)&&(t<n.colorSteps?o.push(a):t-i.brightness(a)>n.colorSteps&&o.push(a))}});var a=[];if(r.times(50,function(r){if(r%n.colorSteps===0){var t=50-r,o=i.lighten(e,t);("#ffffff"!==o||n.preferences.allowBW)&&a.push(o)}}),n.darker=r.unique(o),n.lighter=r.unique(a),n.lightest=r.first(n.lighter),n.darkest=r.last(n.darker),n.lightish=n.lighter.length>2?n.lighter[n.lighter.length-3]:e,n.darkish=n.darker.length>2?n.darker[2]:e,n.alternates=r.unique(n.lighter.concat([e]).concat(n.darker)),"florix"===n.preferences.mode&&(n.darkest||(n.darkest=e),n.alternates.push(n.darkest)),n.deg=360/(n.alternates.length-1),n.size=Math.floor((100/(n.alternates.length-2)+Math.PI)/2),n.color=e,n.tuner={r:i.red(e),g:i.green(e),b:i.blue(e),hex:e,brightness:t},n.brightness=t,n.controlBg=r.first(n.darker),n.controlFg=r.last(n.lighter),n.accent=n.alternates[n.alternates.length-4],n.rotateFactor=r.findIndex(n.alternates,function(e){return e===n.color}),n.ringDeg=n.deg*(n.rotateFactor+1),n.preferences.useHash&&(window.location.hash=e.replace("#","#/")),h())try{n.$apply()}catch(s){}};n.doIt=function(e){d(e)},n.setNewColor=function(e){n.tuner.hex=i.rgbObjToHex(e,!0),n.tuner.brightness=i.brightness(n.tuner.hex),d(n.tuner.hex)},n.setRingRotation=function(){return{transform:"rotate(-"+n.ringDeg+"deg) translateZ(0)"}},n.setRotation=function(e){var r=e+1,t=n.deg*r,o="0 -"+n.size+"em",a="tanuki"===n.preferences.mode?r:n.alternates.length-r,s=r*parseFloat(n.preferences.tweeks[n.preferences.mode].quarble),i="",c="",l="",u;return"tanuki"===n.preferences.mode&&(u=n.preferences.tweeks.tanuki.cappa?-(Math.E*(Math.ceil(r/n.preferences.tweeks.tanuki.klumpf)*n.preferences.tweeks.tanuki.marklar)-Math.ceil(r/n.preferences.tweeks.tanuki.klumpf)):-(Math.E*(r/n.preferences.tweeks.tanuki.klumpf*n.preferences.tweeks.tanuki.marklar-r/n.preferences.tweeks.tanuki.klumpf)),c=" scale("+u*n.preferences.tweeks.tanuki.plark+")",l="-"+u+"vmax",o=""),"florix"===n.preferences.mode&&r===n.alternates.length&&(t=360,o="0 -"+n.size+"em 0 0",a=n.alternates.length),i="rotate("+t+"deg)",{transform:i+c,fontSize:l,margin:o,transitionDelay:s+"s",zIndex:a}},n.setRotationClasses=function(e){var r=Math.abs(n.ringDeg-n.deg*(e+1));return r>90&&270>r?"flip-my-hex":""};var g=function(e,r,t){var o=e-Math.floor(Math.abs(r)/t),a=e-o;return a=0>a?0:a>e?e:a,C=n.alternates[a],n.tuner={r:i.red(C),g:i.green(C),b:i.blue(C),hex:C,brightness:i.brightness(C)},n.color=C,a},m=e.element(window.document.querySelector(".canvas")),k=e.element(window.document.querySelector(".color-ring")),w=new t(m[0],{}),v,y,b,x,C,H,S=0,M=0,D,I,E;w.get("pan").set({direction:t.DIRECTION_ALL,threshold:0}),w.on("panstart",function(e){y=n.alternates.length-1,b=360/y,v=e.srcEvent&&e.srcEvent.changedTouches?e.srcEvent.changedTouches:e.pointers,S=-c.getDegrees(v[0],m[0]),M=n.ringDeg}).on("pan panmove",function(e){v=e.srcEvent&&e.srcEvent.changedTouches?e.srcEvent.changedTouches:e.pointers,D=-c.getDegrees(v[0],m[0]),I=D-S,E=M+I,isNaN(E)&&(E=M),0>E&&(E=c.maxDegrees),E>c.maxDegrees&&(E=0),S=D,k.css({transform:"rotate("+-E+"deg) translateZ(0)",transitionDuration:"0s"}),x=g(y,E,b),M=E,n.$apply()}).on("panend pancancel",function(){H=b*(x+1),M=H,k.css({transform:"rotate("+-H+"deg) translateZ(0)",transitionDuration:""}),n.$apply()}),n.saveColor=function(e){var t=r.findIndex(n.myColors,function(r){return r===e});t>-1?n.myColors.splice(t,1):n.myColors.push(e),s.save("tanuki-colors",n.myColors)},n.shareColors=function(){var e="";r.each(n.myColors,function(r){e+="\n"+r+"\n"}),window.location.href="mailto:?subject=Colors&body="+encodeURIComponent(e)},n.isSaved=function(e){return r.find(n.myColors,function(r){return r===e})},n.loadColor=function(e){n.preferences.useHash?window.location.hash=e.toLowerCase().replace("#","#/"):d(e)},n.setClasses=function(e,r,t){if(e){var n=[];if(t){var o=i.brightness(e)<155?"fg-light":"fg-dark";n.push(o)}return e===r&&n.push("current"),n.join(" ")}},n.hash=window.location.hash?window.location.hash.replace("/",""):"",n.$watch("hash",function(e){d(e)}),n.$watch("tuner",function(e,r){return e&&e!==r?(e.hex=i.rgbObjToHex(e,!0),e.brightness=i.brightness(e.hex),e.hex):void 0},!0),n.$watch("colorSteps",function(e,r){e&&e!==r&&d(n.color)}),n.$watch("preferences",function(e,r){e&&r&&e!==r&&(n.savePrefs=e,(e.mode!==r.mode||e.allowBW!==r.allowBW)&&d(n.color),e.tweeks.florix.shaadik!==r.tweeks.florix.shaadik&&(n.kulra=f(e.tweeks.florix.shaadik,255)))},!0),n.$watch("savePrefs",r.debounce(function(e){e&&s.save("tanuki-preferences",e)},500),!0),a.on("keyup",function(e){32===e.keyCode&&d(),27===e.keyCode&&(n.showMenu=!1,n.showSliders=!1,n.preferences.showFavs=!1,n.preferences.showHistory=!1,n.$apply())})}])}(window.angular,window._,window.Hammer);