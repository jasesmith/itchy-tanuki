!function(e,r,o){"use strict";e.module("app",["picardy.fontawesome","as.sortable"]).directive("tap",[function(){return function(e,r,n){var t=new o(r[0],{});t.on("tap",function(){e.$apply(function(){e.$eval(n.tap)})})}}]).factory("LocalStorage",[function(){var o=function(o){var n,t=window.localStorage.getItem(o);return n=t&&r.isString(t)&&r.isEmpty(t)===!1?e.fromJson(t):t},n=function(r,o){window.localStorage.setItem(r,e.toJson(o))},t=function(e){window.localStorage.removeItem(e)},s=function(){window.localStorage.clear()};return{get:o,save:n,remove:t,clearAll:s}}]).factory("UiHelpers",[function(){var e=360,r=6.283185307179586,o=function(e){var r={};return e&&(r={t:e.offsetTop,r:e.offsetLeft+e.offsetWidth,b:e.offsetTop+e.offsetHeight,l:e.offsetLeft,w:e.offsetWidth,h:e.offsetHeight},r.cx=r.l+r.w/2,r.cy=r.t+r.h/2),r},n=function(e,n){var t=o(n),s=Math.atan2(e.clientY-t.cy,e.clientX-t.cx);return s+=r/4,0>s&&(s+=r),s},t=function(e,r){var o=n(e,r),t=180*o/Math.PI;return t};return{maxRadians:r,maxDegrees:e,getNumbers:o,getRadians:n,getDegrees:t}}]).controller("AppController",["$scope","$document","LocalStorage","ColorService","UiHelpers",function(n,t,s,a,i){r.mixin({clamp2:function(e,r,o){return Math.min(Math.max(e,r),o)}});var c=[{name:"tanuki",icon:"spinner"},{name:"florix",icon:"sun-o"},{name:"blook",icon:"square"}],l={useHash:!1,allowBW:!1,showHistory:!1,showFavs:!1,alwaysShowHex:!1,mode:c[1].name,toolbox:"color",defaultColor:null,fancy:!0,tweeks:{tanuki:{klumpf:2,ichtzy:5,flarp:100,plark:1,marklar:.01,quarble:.08,cappa:!0},florix:{quarble:0,borgee:50,gloosh:100,zarrt:12,syrris:100,shaado:5,shaada:-1,shaadik:0},blook:{quarble:.04}}},u=function q(e,r){return r=r||255,a.rgbObjToHex({r:Math.round(e*r),g:Math.round(e*r),b:Math.round(e*r)},!0)},f=function W(e){32===e.which&&n.doIt(),27===e.which&&(n.showMenu=!1,n.showSliders=!1,n.preferences.showFavs=!1,n.preferences.showHistory=!1,n.$apply())},h=function L(){return!n.$root.$$phase},d=function R(){return window.location.hash},p=function z(e,r,o){e&&e!==n.color&&(n.color=e),o?window.history.replaceState({},"","/"):r&&(window.location.hash=e)},g=function F(){var e=d();n.colorHistory=s.get("tanuki-history")||[],n.myColors=s.get("tanuki-colors")||[],n.modes=c,n.preferences=s.get("tanuki-preferences")||l,n.showMenu=!1,n.showSliders=!1,n.tab="color",n.touching=!1,n.colorSteps=6,n.mode=r.findWhere(c,{name:n.preferences.mode}),n.kulra=u(n.preferences.tweeks.florix.shaadik,255),a.isValidHex(e)||(e=n.preferences.defaultColor),window.console.log("init",e),t.on("keyup",f),n.$on("$destroy",function(){t.off("keyup",f)}),n.sortableOptions={containerPositioning:"relative",containment:".palette",additionalPlaceholderClass:"color-brick parking-spot",dragEnd:function(){var e=r.clone(n.myColors),o=r.map(e,function(e){return e});n.myColors=r.compact(o),s.save("tanuki-colors",n.myColors)}},n.doIt(e)},m=function P(e,o){var t=r.find(e,function(e){return e===o});t!==o&&e.push(o),n.colorHistory=r.last(e,20),s.save("tanuki-history",n.colorHistory)};n.cycleModes=function B(e){n.preferences.showFavs||("blook"===e?n.preferences.mode="tanuki":"florix"===e?n.preferences.mode="blook":n.preferences.mode="florix",n.mode=r.findWhere(c,{name:n.preferences.mode}))},n.clearColorHistory=function j(){n.colorHistory=[],s.save("tanuki-history",n.colorHistory)},n.clearSavedColors=function N(){n.myColors=[],s.save("tanuki-colors",n.myColors)},n.clearPrefs=function O(){s.remove("tanuki-preferences"),s.save("tanuki-preferences",e.copy(l)),window.location.reload()},n.resetTweeks=function A(r){n.preferences.tweeks[r]=e.copy(l.tweeks[r])},n.doIt=function U(e){e=a.isValidHex(e)?a.toHex(e).toLowerCase():a.randomHex().toLowerCase(),m(n.colorHistory,e);var o=a.brightness(e),t=[];r.times(50,function(r){if(r%n.colorSteps===0){var s=a.darken(e,r);("#000000"!==s||n.preferences.allowBW)&&(o<n.colorSteps?t.push(s):o-a.brightness(s)>n.colorSteps&&t.push(s))}});var s=[];if(r.times(50,function(r){if(r%n.colorSteps===0){var o=50-r,t=a.lighten(e,o);("#ffffff"!==t||n.preferences.allowBW)&&s.push(t)}}),n.darker=r.unique(t),n.lighter=r.unique(s),n.lightest=r.first(n.lighter),n.darkest=r.last(n.darker),n.lightish=n.lighter.length>2?n.lighter[n.lighter.length-3]:e,n.darkish=n.darker.length>2?n.darker[2]:e,n.shades=r.unique(n.lighter.concat([e]).concat(n.darker)),"florix"===n.preferences.mode&&(n.darkest||(n.darkest=e),n.shades.push(n.darkest)),n.controlBg=r.first(n.darker),n.controlFg=r.last(n.lighter),n.deg=360/(n.shades.length-1),n.size=Math.floor((100/(n.shades.length-2)+Math.PI)/2),n.color=e,n.tuner={r:a.red(e),g:a.green(e),b:a.blue(e),hex:e,brightness:o},n.rotateFactor=r.findIndex(n.shades,function(r){return r===e}),n.ringDeg=n.deg*(n.rotateFactor+1),p(e,n.preferences.useHash),h())try{n.$apply()}catch(i){}},n.setNewColor=function V(e){n.tuner.hex=a.rgbObjToHex(e,!0),n.tuner.brightness=a.brightness(n.tuner.hex),n.doIt(n.tuner.hex)},n.setRingRotation=function J(){return{transform:"rotate(-"+n.ringDeg+"deg) translateZ(0)"}},n.setRotation=function Z(e){var r=e+1,o=n.deg*r,t="0 -"+n.size+"em",s="tanuki"===n.preferences.mode?r:n.shades.length-r,a=r*parseFloat(n.preferences.tweeks[n.preferences.mode].quarble),i="",c="",l="",u;return"tanuki"===n.preferences.mode&&(u=n.preferences.tweeks.tanuki.cappa?-(Math.E*(Math.ceil(r/n.preferences.tweeks.tanuki.klumpf)*n.preferences.tweeks.tanuki.marklar)-Math.ceil(r/n.preferences.tweeks.tanuki.klumpf)):-(Math.E*(r/n.preferences.tweeks.tanuki.klumpf*n.preferences.tweeks.tanuki.marklar-r/n.preferences.tweeks.tanuki.klumpf)),c=" scale("+u*n.preferences.tweeks.tanuki.plark+")",l="-"+u+"vmax",t=""),"florix"===n.preferences.mode&&r===n.shades.length&&(o=360,t="0 -"+n.size+"em 0 0",s=n.shades.length),i="rotate("+o+"deg)",{transform:i+c,fontSize:l,margin:t,transitionDelay:a+"s",zIndex:s}},n.setRotationClasses=function _(e){var r=Math.abs(n.ringDeg-n.deg*(e+1));return r>90&&270>r?"flip-my-hex":""};var k=function X(e,r,o){var t=o/2,s=e-Math.floor(Math.abs(r-t)/o),i=e-s,c;return i=0>i?0:i>e?e:i,c=n.shades[i],n.tuner={r:a.red(c),g:a.green(c),b:a.blue(c),hex:c,brightness:a.brightness(c)},{color:c,key:i}},w=e.element(window.document.querySelector(".canvas")),v=e.element(window.document.querySelector(".color-ring")),y,b,x,C={},H,S=0,I=0,M,D,E,T=new o(w[0],{});T.get("pan").set({direction:o.DIRECTION_ALL,threshold:0}),T.on("panstart",function Y(e){b=n.shades.length-1,x=360/b,y=e.srcEvent&&e.srcEvent.changedTouches?e.srcEvent.changedTouches:e.pointers,S=-i.getDegrees(y[0],w[0]),I=n.ringDeg}).on("pan panmove",function G(e){y=e.srcEvent&&e.srcEvent.changedTouches?e.srcEvent.changedTouches:e.pointers,M=-i.getDegrees(y[0],w[0]),D=M-S,E=I+D,isNaN(E)&&(E=I),0>E&&(E=i.maxDegrees),E>i.maxDegrees&&(E=0),S=M,v.css({transform:"rotate(-"+E+"deg) translateZ(0)",transitionDuration:"0s"}),C=k(b,E,x),p(C.color,!1,!0),I=E,n.$apply()}).on("panend pancancel",function K(){H=x*(C.key+1),n.ringDeg=H,v.css({transitionDuration:""}),n.$apply()}),n.saveColor=function Q(e){var o=r.findIndex(n.myColors,function(r){return r===e});o>-1?n.myColors.splice(o,1):(n.myColors.push(e),n.doIt(e)),s.save("tanuki-colors",n.myColors)},n.shareColors=function ee(){var e="";r.each(n.myColors,function(r){e+="\n"+r+"\n"}),window.location.href="mailto:?subject=Colors&body="+encodeURIComponent(e)},n.isSaved=function re(e){return r.find(n.myColors,function(r){return r===e})},n.setClasses=function oe(e,r,o){if(e){var n=[];if(o){var t=a.brightness(e)<155?"fg-light":"fg-dark";n.push(t)}return e===r&&n.push("current"),n.join(" ")}},n.$watch("tuner",function(e,r){return e&&e!==r?(e.hex=a.rgbObjToHex(e,!0),e.brightness=a.brightness(e.hex),e.hex):void 0},!0),n.$watch("colorSteps",function(e,r){e&&e!==r&&n.doIt(n.color)}),n.$watch("preferences",function(e,r){e&&r&&e!==r&&(n.savePrefs=e,(e.mode!==r.mode||e.allowBW!==r.allowBW)&&n.doIt(n.color),e.tweeks.florix.shaadik!==r.tweeks.florix.shaadik&&(n.kulra=u(e.tweeks.florix.shaadik,255)),e.useHash!==r.useHash&&p(n.color,e.useHash,!e.useHash))},!0),n.$watch("savePrefs",r.debounce(function(e){e&&s.save("tanuki-preferences",e)},500),!0),window.onpopstate=function(e){var r=d();a.isValidHex(r)&&n.doIt(r)},g()}])}(window.angular,window._,window.Hammer);