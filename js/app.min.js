!function(e,r){"use strict";angular.module("app",["jamfu","ui.sortable"]).controller("AppController",["$scope","$location","StorageService","UtilityService",function(e,t,o,n){var s={useHash:!1,allowBW:!1,showHistory:!1,alwaysShowHex:!1,tanukiMode:!1,tweeks:{klumpf:2,ichtzy:5,flarp:100,plark:1,marklar:.01,quarble:.08,cappa:!0}};e.headline="Itchy Tanuki",e.icon="circle-o",e.colorHistory=o.get("tanuki-history")||[],e.myColors=o.get("tanuki-colors")||[],e.preferences=o.get("tanuki-preferences")||s,e.showMenu=!1,e.showSliders=!1,e.colorSteps=4,e.sortableOptions={placeholder:"color-brick parking-spot",tolerance:"pointer",stop:function(){var t=r.clone(e.myColors),n=r.map(t,function(e){return e});e.$apply(),e.myColors=r.compact(n),o.save("tanuki-colors",e.myColors)}};var a=function u(){return!e.$root.$$phase},i=function(t,n){var s=r.find(t,function(e){return e===n});s!==n&&t.push(n),e.colorHistory=r.last(t,25),o.save("tanuki-history",e.colorHistory)};e.clearColorHistory=function(){e.colorHistory=[],o.save("tanuki-history",e.colorHistory)},e.clearSavedColors=function(){e.myColors=[],o.save("tanuki-colors",e.myColors)},e.resetTweeks=function(){e.preferences.tweeks=s.tweeks,window.console.log("tweeks")};var l=function(t){t=t?t.toLowerCase():n.randomHexColor().toLowerCase(),i(e.colorHistory,t);var o=n.colorBrightness(t),s=[];r.times(50,function(r){if(r%e.colorSteps===0){var a=t.darken(r);("#000000"!==a||e.preferences.allowBW)&&(o<e.colorSteps?s.push(a):o-n.colorBrightness(a)>e.colorSteps&&s.push(a))}});var l=[];r.times(50,function(r){if(r%e.colorSteps===0){var o=50-r,n=t.lighten(o);("#ffffff"!==n||e.preferences.allowBW)&&l.push(n)}}),e.darker=r.unique(s),e.lighter=r.unique(l),e.lightest=r.first(e.lighter),e.darkest=r.last(e.darker),e.alternates=r.unique(e.lighter.concat([t]).concat(e.darker)),e.preferences.tanukiMode||e.alternates.push(e.darkest),e.deg=360/(e.alternates.length-1),e.size=Math.floor((100/(e.alternates.length-2)+Math.PI)/2),e.color=t,e.tuner={r:t.red(),g:t.green(),b:t.blue(),hex:t,brightness:o},e.brightness=o,e.controlBg=r.first(e.darker),e.controlFg=r.last(e.lighter),e.accent=e.alternates[e.alternates.length-4];var c=r.findIndex(e.alternates,function(r){return r===e.color});if(e.ringDeg=e.deg*(c+1),e.preferences.useHash&&(window.location.hash=t.replace("#","#/")),a())try{e.$apply()}catch(u){}},c=function(e,r){var t=e.b|e.g<<8|e.r<<16|1<<24;return(r?"#":"")+t.toString(16).substring(1,8)};e.setNewColor=function(r){e.tuner.hex=c(r,!0),e.tuner.brightness=n.colorBrightness(e.tuner.hex),l(e.tuner.hex)},e.$watch("tuner",function(e,r){return e&&e!==r?(e.hex=c(e,!0),e.brightness=n.colorBrightness(e.hex),e.hex):void 0},!0),r.mixin({clamp2:function(e,r,t){return Math.min(Math.max(e,r),t)}}),e.setRingRotation=function(){var r=.08*e.alternates.length+"s";return{transform:"rotate(-"+e.ringDeg+"deg) translateZ(0)",transitionDuration:r}},e.setRotation=function(r){var t=r+1,o=e.deg*t,n="0 -"+e.size+"em",s=e.preferences.tanukiMode?t:e.alternates.length-t,a=t*e.preferences.tweeks.quarble+"s",i="",l="",c="",u;return e.preferences.tanukiMode&&(u=e.preferences.tweeks.cappa?-(Math.E*(Math.ceil(t/e.preferences.tweeks.klumpf)*e.preferences.tweeks.marklar)-Math.ceil(t/e.preferences.tweeks.klumpf)):-(Math.E*(t/e.preferences.tweeks.klumpf*e.preferences.tweeks.marklar-t/e.preferences.tweeks.klumpf)),l=" scale("+u*e.preferences.tweeks.plark+")",c="-"+u+"vmax",n=""),e.preferences.tanukiMode||t!==e.alternates.length||(o=360,n="0 -"+e.size+"em 0 0",s=e.alternates.length),i="rotate("+o+"deg)",{transform:i+l,fontSize:c,margin:n,transitionDelay:a,zIndex:s}},e.setRotationClasses=function(r){var t=Math.abs(e.ringDeg-e.deg*(r+1));return t>90&&270>t?"flip-my-hex":""},e.doIt=function(){l()},e.saveColor=function(t){var n=r.findIndex(e.myColors,function(e){return e===t});n>-1?e.myColors.splice(n,1):e.myColors.push(t),o.save("tanuki-colors",e.myColors)},e.shareColors=function(){var t="";r.each(e.myColors,function(e){t+="\n"+e+"\n"}),window.location.href="mailto:?subject=Colors&body="+encodeURIComponent(t)},e.isSaved=function(t){return r.find(e.myColors,function(e){return e===t})},e.loadColor=function(r){e.preferences.useHash?window.location.hash=r.toLowerCase().replace("#","#/"):l(r)},e.setClasses=function(e,r,t){if(e){var o=[];if(t){var s=n.colorBrightness(e)<155?"fg-light":"fg-dark";o.push(s)}return e===r&&o.push("current"),o.join(" ")}},e.$watch(function(){var e=window.location.hash;return e?e.replace("/",""):""},function(e){l(e)}),e.$watch("colorSteps",function(r,t){r&&r!==t&&l(e.color)},!0),e.$watch("preferences",r.debounce(function(r){e.$apply(function(){window.console.log(r),o.save("tanuki-preferences",r)})},100),!0),$(window.document).on("keyup",function(e){32===e.keyCode&&l()})}])}(window.angular,window._);